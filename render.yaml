services:
  # Backend API Service (Normal Python Deployment - No Docker)
  - type: web
    name: car-service-api
    env: python
    region: oregon
    plan: free
    # Normal Python deployment - uses pip directly
    # Use build script to properly set CARGO_HOME before any Rust compilation
    buildCommand: cd backend && chmod +x render-build.sh && ./render-build.sh
    # Simple direct start command - Render provides PORT automatically
    startCommand: cd backend && python -m uvicorn app.main:app --host 0.0.0.0 --port ${PORT:-8000} --workers 1
    envVars:
      # Set Python version to avoid 3.13 compilation issues with Rust packages
      - key: PYTHON_VERSION
        value: "3.11.11"
      # Set CARGO_HOME to writable location to avoid read-only filesystem errors
      - key: CARGO_HOME
        value: "/tmp/.cargo"
      - key: RUSTUP_HOME
        value: "/tmp/.rustup"
      # Use your existing Render database URL
      # Replace with your actual Render database URL from the dashboard
      - key: DATABASE_URL
        sync: false
        value: postgresql://health_system_2pbp_user:KRAfa0heCSr0uYqW7Mi0qjZcdaBNyAtV@dpg-d5jnohq4d50c73d4pgm0-a.oregon-postgres.render.com/health_system_2pbp
      # Generate a secure secret key (you can also set this manually in Render dashboard)
      - key: SECRET_KEY
        generateValue: true
      # Update with your frontend URL after deployment
      # Includes localhost for local development and deployed frontend URLs
      - key: CORS_ORIGINS
        value: http://localhost:3000,http://localhost:5173,https://car-service-frontend.onrender.com,https://car-maintenance-system.onrender.com
      - key: ALGORITHM
        value: HS256
      - key: ACCESS_TOKEN_EXPIRE_MINUTES
        value: "30"
      - key: EMAIL_ENABLED
        value: "false"
      - key: SMTP_SERVER
        value: smtp.gmail.com
      - key: SMTP_PORT
        value: "587"
      - key: SMTP_USERNAME
        value: ""
      - key: SMTP_PASSWORD
        value: ""
      - key: FROM_EMAIL
        value: ""

  # Frontend Static Site
  - type: web
    name: car-service-frontend
    env: static
    region: oregon
    plan: free
    buildCommand: cd frontend && npm install && npm run build
    staticPublishPath: ./frontend/dist
    envVars:
      # Backend API URL - points to actual deployed backend
      - key: VITE_API_URL
        value: https://car-maintenance-system.onrender.com/api
